
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>상품관리</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
<div class="container mt-4">
  <a href="/admin/products/excel-upload" class="btn btn-secondary mb-2">엑셀 업로드</a>
  <h2>상품 목록</h2>

  <form th:action="@{/admin/products}" method="get" class="mb-2 d-flex align-items-center gap-2">
    <input type="text" name="search" th:value="${search}" placeholder="검색어(상품명,코드,영문)">
    <select name="size" th:value="${size}">
      <option th:selected="${size == 50}" value="50">50개</option>
      <option th:selected="${size == 100}" value="100">100개</option>
      <option th:selected="${size == 250}" value="250">250개</option>
      <option th:selected="${size == 500}" value="500">500개</option>
    </select>
    <button type="submit" class="btn btn-primary btn-sm">검색/갯수적용</button>
  </form>

  <form th:action="@{/admin/products/delete-selected}" method="post" id="deleteForm">
    <table class="table table-bordered table-sm">
      <thead>
      <tr>
        <th><input type="checkbox" id="checkAll" onclick="toggleAll(this)"/></th>
        <th>
          <a th:href="@{/admin/products(sort='productCode,' + (${sort} == 'productCode,asc' ? 'desc' : 'asc'), search=${search}, size=${size})}">
            상품코드<span th:text="${sort=='productCode,asc'?'▲':sort=='productCode,desc'?'▼':''}"></span>
          </a>
        </th>
        <th><a th:href="@{/admin/products(sort='supplierCode,' + (${sort} == 'supplierCode,asc' ? 'desc' : 'asc'), search=${search}, size=${size})}">공급처</a></th>
        <th><a th:href="@{/admin/products(sort='categoryCode,' + (${sort} == 'categoryCode,asc' ? 'desc' : 'asc'), search=${search}, size=${size})}">카테고리</a></th>
        <th><a th:href="@{/admin/products(sort='korName,' + (${sort} == 'korName,asc' ? 'desc' : 'asc'), search=${search}, size=${size})}">한글명</a></th>
        <th><a th:href="@{/admin/products(sort='engName,' + (${sort} == 'engName,asc' ? 'desc' : 'asc'), search=${search}, size=${size})}">영문명</a></th>
        <th>단위값</th>
        <th>단위</th>
        <th>상품상세</th>
        <th>구매가</th>
        <th>묶음수량</th>
        <th>배송비</th>
        <th>소스링크</th>
        <th>사용여부</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="p : ${products}">
        <td><input type="checkbox" name="productCodes" th:value="${p.productCode}"/></td>
        <td th:text="${p.productCode}"></td>
        <td th:text="${p.supplierCode}"></td>
        <td th:text="${p.categoryCode}"></td>
        <td th:text="${p.korName}"></td>
        <td th:text="${p.engName}"></td>
        <td th:text="${p.unitValue}"></td>
        <td th:text="${p.unit}"></td>
        <td th:text="${p.detailsHtml}"></td>
        <td th:text="${p.purchaseCost}"></td>
        <td th:text="${p.packSize}"></td>
        <td th:text="${p.shippingCost}"></td>
        <td>
          <a th:href="${p.sourceLink}" target="_blank" th:text="${p.sourceLink}"></a>
        </td>
        <td th:text="${p.isAvailable ? '사용' : '미사용'}"></td>
      </tr>
      </tbody>
    </table>
    <button class="btn btn-danger" type="submit" onclick="return confirm('삭제하시겠습니까?')">선택삭제</button>
  </form>

  <!-- 페이징 네비게이션 -->
  <nav th:if="${products.totalPages > 1}">
    <ul class="pagination pagination-sm mt-2">
      <li class="page-item" th:classappend="${products.first}? 'disabled'">
        <a class="page-link" th:href="@{/admin/products(page=${products.number-1}, size=${size}, search=${search}, sort=${sort})}">이전</a>
      </li>
      <li class="page-item"
          th:each="i : ${#numbers.sequence(0, products.totalPages-1)}"
          th:classappend="${i == products.number} ? 'active'">
        <a class="page-link"
           th:href="@{/admin/products(page=${i}, size=${size}, search=${search}, sort=${sort})}"
           th:text="${i+1}"></a>
      </li>
      <li class="page-item" th:classappend="${products.last}? 'disabled'">
        <a class="page-link" th:href="@{/admin/products(page=${products.number+1}, size=${size}, search=${search}, sort=${sort})}">다음</a>
      </li>
    </ul>
  </nav>

</div>
<script>
  function toggleAll(source) {
    let boxes = document.querySelectorAll('input[name="productCodes"]');
    boxes.forEach(cb => cb.checked = source.checked);
  }
</script>
</body>
</html>
